function AudioEngine(){var e,n=this,t=null,o=null,a=0,i=0;this.sampler0=null,this.sampler1=null,this.begin=function(){if(aut()){this.sampler0=new Sampler(0),this.sampler1=new Sampler(1);try{e=new webkitAudioContext}catch(n){e=new AudioContext}if(!e)return void console.log("***WARNING: Failed to create audio context");e.createJavaScriptNode?(t=e.createJavaScriptNode(2048,2,2),o=e.createJavaScriptNode(2048,2,2)):(t=e.createScriptProcessor(2048,2,2),o=e.createScriptProcessor(2048,2,2)),t.onaudioprocess=this.sampler0.processAudio(),o.onaudioprocess=this.sampler1.processAudio(),e.createGainNode?(a=e.createGainNode(),i=e.createGainNode()):(a=e.createGain(),i=e.createGain()),t.connect(a),o.connect(i),a.connect(e.destination),i.connect(e.destination),a.gain.value=.5,i.gain.value=.5,this.sampler0.begin(),this.sampler1.begin()}},this.clearDeck=function(e){n.pause(e),n["sampler"+e].clearDeck()},this.updateAudioData=function(t,o){n.pause(o),e.decodeAudioData(t,function(e){n["sampler"+o].updateAudio(e),n["sampler"+o].deckModel.onSongDecodingComplete()},function(e){dbg("***WARNING: AudioEngine.updateAudioData(): decoding failed with error = "+e),n["sampler"+o].deckModel.onSongDecodingFailed()})},this.play=function(e){this["sampler"+e].play()},this.pause=function(e){this["sampler"+e].pause()},this.updateSpeed=function(e,n){this["sampler"+n].updateSpeed(e)},this.setGain=function(e,n){0==n?a.gain.value=e:i.gain.value=e}}function Sampler(e){var n=this;this.deckInd=e,this.turntableController=null,this.deckModel=null;var t=!1;this.channelIndex=e;var o=0,a=0,i=0,r=0,s=0,l=0,d=0;this.sampleEnd=0,this.playHead=0;for(var u=1,c=1,h=0,g=!0,f=0,p=0,v=0,m=0,y=0,S=0,M=0,w=1,E=1,C=1,P=0,L=0,I=0,k=0,b=0,T=0,A=0,D=0,R=0,x=0,N=0,H=0,F=0,G=0,O=0,_=[],$=[],V=.5,W=.5,B=0,K=0,U=0,z=0,q=0,Y=2,J=1,Z=-1,j=-1,X=!0,Q=!0,en=1,nn=.01,tn=1,on=0,an=0,rn=0,sn=0,ln=0,dn=0,un=0,cn=0,hn=0,gn=0,fn=0,pn=0,vn=0,mn=0,yn=0,Sn=0,Mn=0,wn=0,En=0,Cn=0,Pn=0,Ln=0,In=0,kn=0,bn=0,Tn=0,An=0,Dn=0,Rn=0,xn=!1,Nn=!1,Hn=!0,Fn=!0,Gn=!1,On=!1,_n=!1,$n=0,Vn=.5,Wn=.5,Bn=16317,Kn=0,Un=[],zn=0;Bn>zn;zn++)Un.push(1);var qn=0,Yn=0,Jn=0,Zn=0,jn=0,Xn=[],Qn=[],et=[],nt=[],tt=[],ot=[],at=[],it=[],rt=0,st=0,lt=0,dt=0,ut=0,ct=0,ht=0,gt=0,ft=0,pt=0,vt=0,mt=0,yt=0,St=0,Mt=0,wt=0,Et=0,Ct=0,Pt=0,Lt=0,It=0,kt=0,bt=0,Tt=0,At=0,Dt=0,Rt=0,xt=0,Nt=0,Ht=0,Ft=0,Gt=0,Ot=0,_t=0,$t=0,Vt=0,Wt=0,Bt=0,Kt=0,Ut=0;this.begin=function(){n.resetReverb(.05,.9),n.setReverbLevels(.5,.5)},this.clearDeck=function(){zt(),l=0,d=0,n.sampleEnd=0},this.updateAudio=function(e){l=e.getChannelData(0),d=e.getChannelData(1),n.sampleEnd=e.length,this.deckModel.currentSong.duration=n.sampleEnd/44.1,this.deckModel.isReadyToPlay=!0},this.play=function(){t=!0},this.pause=function(){t=!1},this.updateSpeed=function(e){c=e,g=!1};var zt=function(){n.pause(),n.playHead=0,n.turntableController.degradeSpeedToZero()};this.processAudio=function(){return function(e){var An,Rn;for(outL=e.outputBuffer.getChannelData(0),outR=e.outputBuffer.getChannelData(1),An=0,Rn=outL.length;Rn>An;An++)t?(++s,0==g&&(h=u-c,0>h&&(h=-h),h>1e-6?u+=.001*(c-u):(u=c,g=!0)),n.playHead+=u,n.playHead>=n.sampleEnd-1?(n.playHead=0,zt(),o=a=0):n.playHead<=0?(n.playHead=0,o=a=0):(f=Math.floor(n.playHead),p=f+1,v=n.playHead-f,m=1-v,i=l[f]*m+l[p]*v,r=d[f]*m+d[p]*v,0==(3&s)&&(en=tn,j!=en&&(j=en,X||(X=!0),en>1?en=1:0>en&&(en=0)),X&&(0==Y?J=1e-6*Math.exp(9.210340371976182*en)+.99*J:(en=.3+.7*en,J=1e-6*Math.exp(9.2*en)+.99*J),Z!=J?Z=J:X=!1)),Q&&0==X?(o=i,a=r):0==Y?(z*=nn,z+=(i-o)*J,o+=z,q*=nn,q+=(r-a)*J,a+=q):(X&&0==(3&s)&&(mn=yn=3.13*J,mn*=1.27323954-.405284735*mn,mn*=.225*(mn-1)+1,yn+=1.57079632,yn>3.14159265&&(yn-=6.28318531),yn*=0>yn?1.27323954+.405284735*yn:1.27323954-.405284735*yn,yn*=0>yn?-.225*(yn+1)+1:.225*(yn-1)+1,Sn=.005>J?mn/(nn*J*200):mn/nn,1==Y?(Mn=.5*(1+yn),wn=-(1+yn),En=.5*(1+yn)):(Mn=.5*(1-yn),wn=1-yn,En=.5*(1-yn)),Cn=1+Sn,Pn=-2*yn,Ln=1-Sn,on=Mn/Cn,an=wn/Cn,rn=En/Cn,sn=Pn/Cn,ln=Ln/Cn),o=on*i+an*dn+rn*cn-sn*gn-ln*pn,cn=dn,dn=i,pn=gn,gn=o,a=on*r+an*un+rn*hn-sn*fn-ln*vn,hn=un,un=r,vn=fn,fn=a),P>1&&(0==L?(I=o,k=a):(o=I,a=k),L++,L==P&&(L=0)),E>1&&(B=o,K=a,M>0?(y=o*E,S=Math.sin(y),o=Math.sin(y*w+S*M),y=a*E,S=Math.sin(y),a=Math.sin(y*w+S*M)):(o*=E,a*=E),o>1?o=B*U+1:-1>o&&(o=B*U-1),o*=C,a>1?a=K*U+1:-1>a&&(a=K*U-1),a*=C),V>0&&G>0&&(T+=b,T>2&&(T-=4),A=.5*(1+T*(2-(0>T?-T:T))),D=(G-1)*A,R=Math.floor(O-D),0>R&&(R+=G),x=R,N=x+1,H=R-x,F=1-H,N>=G&&(N=G-1),_[O]=o,$[O]=a,++O>=G&&(O=0),o=o*W+(_[x]*F+_[N]*H)*V,a=a*W+($[x]*F+$[N]*H)*V))):o=a=0,xn?(In=bn=o,kn=a,bn+=kn,Tn>0&&($n=bn*Tn),Dn>0&&(Jn=bn*Dn)):(In=o,kn=a),On&&(Yn=qn-Bn+1,0>Yn&&(Yn+=Bn),Kn=Un[Yn],Un[qn]=$n+Kn*Wn,++qn==Bn&&(qn=0),Kn*=Vn),_n&&(ft=rt-At+1,0>ft&&(ft+=At),Ot=Xn[ft],Xn[rt]=Jn+Ot*Et,++rt==At&&(rt=0),pt=st-Dt+1,0>pt&&(pt+=Dt),_t=Qn[pt],Qn[st]=Jn+_t*Ct,++st==Dt&&(st=0),vt=lt-Rt+1,0>vt&&(vt+=Rt),$t=et[vt],et[lt]=Jn+$t*Pt,++lt==Rt&&(lt=0),mt=dt-xt+1,0>mt&&(mt+=xt),Vt=nt[mt],nt[dt]=Jn+Vt*Lt,++dt==xt&&(dt=0),yt=ut-Nt+1,0>yt&&(yt+=Nt),Wt=tt[yt],tt[ut]=Jn+Wt*It,++ut==Nt&&(ut=0),St=ct-Ht+1,0>St&&(St+=Ht),Bt=ot[St],ot[ct]=Jn+Bt*kt,++ct==Ht&&(ct=0),Mt=ht-Ft+1,0>Mt&&(Mt+=Ft),Kt=at[Mt],at[ht]=Jn+Kt*bt,++ht==Ft&&(ht=0),wt=gt-Gt+1,0>wt&&(wt+=Gt),Ut=it[wt],it[gt]=Jn+Ut*Tt,++gt==Gt&&(gt=0),Zn=Ot+$t+Wt+Kt,jn=_t+Vt+Bt+Ut),Gn?(outL[An]=In+Kn+.125*(Zn+.5*jn),outR[An]=kn+Kn+.125*(jn+.5*Zn),$n=Jn=0):(outL[An]=In,outR[An]=kn)}};this.setBaseCutoff=function(e){tn=e,qt()},this.setResonance=function(e){switch(Y){case 1:case 2:nn=0==e?.05:.1*e,nn*=2;break;default:if(0==e)nn=.01;else{e/=100;var n=.001,t=1.01,o=Math.log(t/n),a=1/o;nn=Math.log(e/n)*a}}Z=-1,X=!0,qt()};var qt=function(){Q=0==Y?.01==nn&&1==tn?!0:!1:1==Y?!1:.1==nn&&1==tn?!0:!1};this.setChorusSpeed=function(e){b=e},this.getChorusSize=function(){return G},this.setChorusSize=function(e){G=e,_=[],$=[];for(var n=0;e>n;n++)_.push(0),$.push(0);O=0},this.setChorusDryWetLevel=function(e){e*=.005,W=1-e,V=e/2},this.setOverdrive=function(e){if(0==e)E=1;else{e=U=.01*e;var n=1,t=2e3,o=Math.log(t/n);E=n*Math.exp(e*o),C=.14+1/E,.15>C&&(C=.15)}},this.setBitrate=function(e){P=e,L=0},this.setOverdriveModulation=function(e){if(0==e)M=0,S=0;else if(1==e)M=1;else{var n=.001,t=1.01,o=Math.log(t/n),a=1/o;M=Math.log(e/n)*a}w=1-M},this.resetDelayTime=function(){Un=[];for(var e=0;Bn>e;e++)Un.push(1);qn=0},this.setChannelDelay=function(e){e*=.01,Tn=e,Yt()},this.getChannelDelay=function(){return Tn},this.setReverbLevels=function(e,n){this.reverbLevel=e/4,this.reverbWidth=n},this.resetReverb=function(e,n){function t(){for(var t,o=8,a=e,i=n,r=-3*a/(Math.log(i)*Math.LOG10E),s=0;o>s;++s){var l=a/Math.pow(2,s/o),d=Math.pow(10,-(3*l/r)),u=Math.floor(44100*l);switch(s){case 0:for(At=u,Xn=[],t=0;At>t;t++)Xn.push(1);Et=d;break;case 1:for(Dt=u,Qn=[],t=0;Dt>t;t++)Qn.push(1);Ct=d;break;case 2:for(Rt=u,et=[],t=0;Rt>t;t++)et.push(1);Pt=d;break;case 3:for(xt=u,nt=[],t=0;xt>t;t++)nt.push(1);Lt=d;break;case 4:for(Nt=u,tt=[],t=0;Nt>t;t++)tt.push(1);It=d;break;case 5:for(Ht=u,ot=[],t=0;Ht>t;t++)ot.push(1);kt=d;break;case 6:for(Ft=u,at=[],t=0;Ft>t;t++)at.push(1);bt=d;break;case 7:for(Gt=u,it=[],t=0;Gt>t;t++)it.push(1);Tt=d}}}rt=st=lt=dt=ut=ct=ht=gt=0,t()},this.setChannelReverb=function(e){e*=.01,Dn=e,Yt()},this.getChannelReverb=function(){return Dn};var Yt=function(){Tn>0||An>0?On=!0:(On=!1,Kn=0),Dn>0||Rn>0?_n=!0:(_n=!1,Zn=jn=0),Gn=On||_n?!0:!1,xn=Hn&&(Dn>0||Tn>0)?!0:!1,Nn=Fn&&(Rn>0||An>0)?!0:!1};this.setEnableChannel=function(e,n){switch(e){case 0:Hn=n;break;case 1:Fn=n}}}function SongLoader(e,$scope){var n=this;this.deckModel=e;var t=null;this.abortLoading=function(){t&&(t.removeEventListener("progress",o,!1),t.removeEventListener("load",a,!1),t.removeEventListener("error",i,!1),t.abort())},this.loadSong=function(e){t&&n.abortLoading();var s=e.mp3StreamUrl?e.mp3StreamUrl:e.mp3DownloadUrl;s||i(null),t=new XMLHttpRequest,t.addEventListener("progress",o,!1),t.addEventListener("load",a,!1),t.addEventListener("error",i,!1),t.addEventListener("abort",r,!1),t.open("GET",s,!0),e.sourceType==SongModel.TYPE_GDRIVE&&(t.setRequestHeader("Authorization","Bearer "+$scope.gDriveModel.accessToken),t.setRequestHeader("GData-Version","3.0")),t.responseType="arraybuffer",t.send()};var o=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n.deckModel.onSongLoadingProgress(t)}else dbg("***WARNING: SongLoader.updateProgress(): can't calculate percent")},a=function(){200==t.status?n.deckModel.onSongLoaded(t.response):(dbg("***WARNING: SongLoader.transferComplete(): failed to load song data: status = "+t.status),n.deckModel.onSongLoadingFailed()),t=null},i=function(){n.deckModel.onSongLoadingFailed(),t=null},r=function(){n.deckModel.onSongLoadingCanceled(),t=null}}function AutoPlayerModel($scope,e,n){var t=!1;this.reportLoading=function(n){t=n==e},this.routeSong=function(o){var a;a=e.currentSong?n.currentSong?!e.isPlaying&&n.isPlaying?e:!n.isPlaying&&e.isPlaying?n:0==$scope.mixerController.crossFader?n:1==$scope.mixerController.crossFader?e:t?n:e:n:e,a.loadSong(o)},this.toggleGeneralPlay=function(){$scope.toggleAutoPlay((n.isPlaying||null==n.currentSong||n.percentageLoaded<100)&&(e.isPlaying||null==e.currentSong||e.percentageLoaded<100)?!1:!0)}}function Config(){}function aut(){return!0}function KeyboardController($scope){var e=!1,n=!1,t=[],o=!1,a=!1,i=!1,r=27,s=32,l=37,d=38,u=39,c=40,h=91,g=$scope.mixerController;this.enableKeyboard=function(){n||(n=!0,window.addEventListener("keydown",p,!1),window.addEventListener("keyup",v,!1),window.addEventListener("blur",f,!1))},this.disableKeyboard=function(){n&&(n=!1,window.removeEventListener("keydown",p,!1),window.removeEventListener("keyup",v,!1),window.removeEventListener("blur",f,!1),e=!1,t=[])};var f=function(){e=!1,t=[],o=!1,a=!1,i=!1},p=function(n){n.keyCode==h&&(i=!0),(n.keyCode==s||n.keyCode==l||n.keyCode==u||n.keyCode==d||n.keyCode==c)&&n.preventDefault(),t.indexOf(n.keyCode)>=0||(t.push(n.keyCode),i||n.ctrlKey?(t=[],e=!1,o=!1,a=!1):(o=n.shiftKey,a=n.altKey,m(n.keyCode)))},v=function(n){n.keyCode==h&&(i=!1);var r=t.indexOf(n.keyCode);r>=0&&t.splice(r,1),o=n.shiftKey,a=n.altKey,t.length<=0&&(e=!1)},m=function(e){switch(e){case r:$scope.hideKbCheatSheet();var n=chrome.app.window.current();n.isFullscreen()&&n.restore();break;case s:$scope.mainModel.autoPlayerModel.toggleGeneralPlay();break;case 48:$scope.togglePlay(1);break;case 49:$scope.togglePlay(0);break;case l:case u:y(e)}},y=function(n){o&&a?g.moveCrossFaderToLimit(n==l,MixerController.CROSS_FADE_FAST):o?g.moveCrossFaderToLimit(n==l,MixerController.CROSS_FADE_SLOW):a?g.moveCrossFaderToLimit(n==l,MixerController.CROSS_FADE_IMMEDIATE):o||a||e||(e=!0)};this.onEnterFrame=function(){if(e){var n=t.indexOf(l)>=0,o=t.indexOf(u)>=0;n&&!o&&g.scrubCrossFader(!0),o&&!n&&g.scrubCrossFader(!1)}}}function SearchModel($scope,e){var n=this;this.songPreloader=null;var t=$scope.songsModel.searchResultPL,o=!1,a="",i=0,r=[],s=[];this.searchAllowed=!1,$scope.previousAllowed=!1,$scope.nextAllowed=!1;var l=null;this.onPreloadingDone=function(){searchAllowed=!0,o=!1},this.newSearch=function(e,n){o||(l=n,a=e,i=0,r=null,s=null,d(0))},this.nextPage=function(){return o?($scope.previousAllowed=!1,$scope.nextAllowed=!1,void($scope.$$phase||$scope.$apply())):(l=null,i++,void d(1))},this.previousPage=function(){return o?($scope.previousAllowed=!1,$scope.nextAllowed=!1,void($scope.$$phase||$scope.$apply())):(l=null,i--,void d(-1))};var d=function(n){$scope.songsModel.choosePlayList(PlayListModel.TYPE_SOUNDCLOUD),o=!0,searchAllowed=!1;var l,d=[];for(l=0;l<t.songs.length;l++)d.push(t.songs[l]);$scope.previousAllowed=i>0,$scope.songsModel.hideSongsList(function(){switch(n){case 0:t.setState(PlayListModel.STATE_SEARCHING),t.clearSongs(),e.doSearch(a,i,u,p);break;case-1:for(t.setState(PlayListModel.STATE_FETCHING_MORE),s=[],l=0;l<d.length;l++)s.push(d[l]);t.clearSongs(),t.addSongs(r),r=null,$scope.songsModel.updateSongsList(),e.doSearch(a,i-1,c,p);break;case 1:for(t.setState(PlayListModel.STATE_FETCHING_MORE),r=[],l=0;l<d.length;l++)r.push(d[l]);t.clearSongs(),t.addSongs(s),$scope.songsModel.updateSongsList(),s=null,e.doSearch(a,i+1,h,p);break;default:dbg("***ERROR: performSearch(): illegal pageStep = "+n)}})},u=function(e){t.addSongs(e),$scope.songsModel.updateSongsList(),g()},c=function(e){r=e,g()},h=function(e){s=e,g()},g=function(){s?!r&&i>0?(t.setState(PlayListModel.STATE_FETCHING_MORE),e.doSearch(a,i-1,c,p)):f():(t.setState(PlayListModel.STATE_FETCHING_MORE),e.doSearch(a,i+1,h,p))},f=function(){$scope.previousAllowed=i>0,$scope.nextAllowed=s.length>0,n.searchAllowed=n.songPreloader.songPreloadingDone,o=!n.songPreloader.songPreloadingDone,t.setState(PlayListModel.STATE_IDLE),$scope.$$phase||$scope.$apply(),l&&l()},p=function(){dbg("*** WARNING onSearchFailed()"),a="",i=0,r=null,s=null,o=!1,$scope.previousAllowed=!1,$scope.nextAllowed=!1,searchAllowed=n.songPreloader.songPreloadingDone,t.setState(PlayListModel.STATE_FAILED),t.clearSongs(),$scope.songsModel.updateSongsList()}}function SongPreloader($scope,e,n){var t=this;this.songPreloadingDone=!1;var o=[],a=[],i=0,r=50,s=[$scope.songsModel.favoritesPL,$scope.songsModel.historyPL];this.begin=function(){o=[];for(var n=0,t=0,a=s.length;a>t;t++)s[t].setState(PlayListModel.STATE_SEARCHING),$scope.mainModel.storageModel.getPlayListIds(s[t].plId,function(t){if(t)for(var i=0,r=t.length;r>i;i++)o.indexOf(t[i])<0&&o.push(t[i]);++n>=a&&e.newSearch("",l)})};var l=function(){d()},d=function(){var e=o.slice(i,i+r);i+=r,n.preloadSongs(e,u,null)},u=function(n){var r;for(r=0,len=n.length;len>r;r++)a.push(n[r]);if(i<o.length)d();else{var l,u,h=!1,g=0;for(r=0,len=s.length;len>r;r++)l=s[r],l.setState(PlayListModel.STATE_IDLE),$scope.mainModel.storageModel.getPlayListIds(l.plId,function(n){if(l=s[g],g++,null!=n)for(var o=0;o<n.length;o++){h=!1;for(var i=0;i<a.length;i++)u=a[i],u.songId!=n[o]||(c(l,u),h=!0);h||(u=new SongModel,u.soundCloudId=n[o],u.failed=!0,u.authorName="Oops!",u.title="Loading from SoundCloud failed!",c(l,u))}g>=len&&($scope.mainModel.storageModel.startUpdating(),t.songPreloadingDone=!0,e.onPreloadingDone(),$scope.$$phase||$scope.$apply())})}},c=function(e,n){e.type==PlayListModel.TYPE_FAVORITES&&(n.favorited=!0),e.addSong(n)}}function SongProgressController($scope,e,n){var t=this;this.deckModel=e,this.audioEngine=n;var o=this.deckModel.deckInd;this.currentTimeStamp="00:00";var a=!1;this.toggleDisplayMode=function(){a=!a,this.updateView()},this.updateView=function(){var n;if(e.currentSong&&e.isReadyToPlay){var i=this.audioEngine["sampler"+o].playHead,r=i/44.1,s=this.audioEngine["sampler"+o].sampleEnd;t.currentTimeStamp=a?"-"+msToTimeString((s-i)/44.1):msToTimeString(r),n=i/s}else t.currentTimeStamp=a?"-00:00":"00:00",n=0;$scope["playHeadSlider"+o]=n,$scope.$$phase||$scope.$apply()},this.onPlayHeadSliderChange=function(){if(!this.deckModel.isReadyToPlay)return void this.updateView();var e=this.audioEngine["sampler"+o],n=Math.floor($scope["playHeadSlider"+o]*e.sampleEnd);e.playHead=n,this.updateView()}}function SoundCloudSongSourceModel($scope,e){var n=null,t=null,o=20;this.doSearch=function(e,i,r,s){n=r,t=s;var l=48e4,d="&order=hotness&limit="+o+"&duration[to]="+l;i>0&&(d+="&offset="+i*o),e&&e.length>0&&(d+="&q="+e),a("tracks.json",d)},this.preloadSongs=function(e,o,i){if(!e||e.length<1)return dbg("***WARNING: preloadSongs(): no songs",this),void(o&&o([]));n=o,t=i;for(var r="",s=0,l=e.length;l>s;s++)r+=e[s],l-1>s&&(r+=",");a("tracks.json","&ids="+r)};var a=function(n,t){var o="http://api.soundcloud.com/"+n+"?client_id="+Config.soundCloudClientId+t;e.get(o).success(i).error(r),$scope.$$phase||$scope.$apply()},i=function(e){var t=[];e.forEach(function(e){var n=$scope.songParser.parseSoundCloudSong(e);n&&t.push(n)}),n&&n(t)},r=function(){dbg("***WARNING: loading from soundcloud failed"),t&&t()}}function TurntableController($scope,e,n){var t=this;this.deckModel=e,this.audioEngine=n,this.songProgressController=new SongProgressController($scope,e,n),this.sliderSpeed=0;var o=0,a=0,i=!1,r=0,s=0,l=0,d=0,u=0,c=!1,h=.022,g=125,f=0,p=null,v=0,m=0;this.loadSong=function(){r=u=l=d=0,this.songProgressController.updateView()},this.updateSpeed=function(e){this.sliderSpeed=e},this.onEnterFrame=function(){c&&(this.deckModel.isPlaying&&0==i?(u+=w(),P(u),L(1+.01*this.sliderSpeed)):i?(P(u),E(),L(o/(2*Math.PI)/h)):0==e.isPlaying&&0==i&&(u+=o,P(u),C(),L(o/(2*Math.PI)/h)),0==(3&f++)&&this.songProgressController.updateView(),f>1e5&&(f=0))},this.onMouseDown=function(e){e.preventDefault(),window.document.body.style.cursor="hand",i=!0,0==this.deckModel.isPlaying&&(c=!0,this.audioEngine.play(this.deckModel.deckInd)),document.addEventListener("mousemove",y,!0),document.addEventListener("drag",y,!0),document.addEventListener("mouseup",S,!0),s=M(),r=u=l=d};var y=function(){u=r+(M()-s)},S=function(){window.document.body.style.cursor="auto",a=0,document.removeEventListener("mousemove",y,!0),document.removeEventListener("drag",y,!0),document.removeEventListener("mouseup",S,!0),i=!1},M=function(){var e=g-event.clientX+v,n=g-event.clientY+m,t=Math.atan2(n,e);return t},w=function(){return.13823007675795088*(1+.01*t.sliderSpeed)},E=function(){o=d-l,o<a-Math.PI&&(o+=2*Math.PI),o>a+Math.PI&&(o-=2*Math.PI),l=d,a=o},C=function(){o+=.1*(0-o),Math.abs(o)<.001&&(t.audioEngine.pause(t.deckModel.deckInd),c=!1,o=0)};this.onPlayChange=function(e){e?(c=!0,this.audioEngine.play(this.deckModel.deckInd)):t.degradeSpeedToZero()},this.degradeSpeedToZero=function(){o=w(),t.deckModel.isPlaying=!1};var P=function(e){e>d+Math.PI&&(d+=2*Math.PI),e<d-Math.PI&&(d-=2*Math.PI),d+=.666*(e-d),t.deckModel.vinylRenderer.rotateVinyl(d)},L=function(e){t.audioEngine.updateSpeed(e,t.deckModel.deckInd)},I=function(){var e=findElementPosition(p);v=e[0],m=e[1]},k=function(){window.addEventListener("DOMContentLoaded",function(){p=window.document.getElementById("vinylCanvas"+t.deckModel.deckInd),I(),$(window).resize(function(){I()})})};k()}function VinylRenderer(e,$scope){var n=this;this.deckInd=e,this.bgImage=null,this.vinylImage=null,this.hasVinylImage=!1;var t="img/"+(isHiRes()?"2x":"default")+"/vinylDrag.png";window.addEventListener("DOMContentLoaded",function(){n.canvas=window.document.getElementById("vinylCanvas"+n.deckInd),n.context=n.canvas.getContext("2d"),n.helperCanvas=window.document.getElementById("helperCanvas"+n.deckInd),n.helperContext=n.helperCanvas.getContext("2d"),n.bgImage=null,n.bgImage=new Image,n.bgImage.src="img/"+(isHiRes()?"2x":"default")+"/vinylRenderBg.png",n.bgImage.addEventListener("load",function(){n.clearDeck()})}),this.clearDeck=function(){n.renderImage(null)},this.renderImage=function(e){n.vinylImage&&n.vinylImage.removeEventListener("load",o),n.vinylImage=null,n.vinylImage=new Image,n.vinylImage.src=e&&e.length>0?e:t,n.vinylImage.addEventListener("load",o)};var o=function(){n.vinylImage.removeEventListener("load",o);var e=n.helperCanvas,a=n.helperContext;n.hasVinylImage=n.vinylImage.src&&n.vinylImage.src.split("/").pop()!==t.split("/").pop(),$scope.$$phase||$scope.$apply(),a.save(),a.drawImage(n.vinylImage,0,0,250,250),a.globalCompositeOperation="destination-in",a.beginPath(),a.arc(e.width/2,e.height/2,116,0,2*Math.PI,!1),a.fillStyle="green",a.fill(),a.restore(),n.rotateVinyl(0)};this.rotateVinyl=function(e){var t=n.context;t.save(),t.translate(131,130),t.rotate(e),t.drawImage(n.bgImage,-125,-125,250,250),t.drawImage(n.helperCanvas,-125,-125,250,250),t.restore()}}function dbg(){}function onError(){}function msToTimeString(e){var n,t,o,a,i,r,s=":",l="";return 0==e?(a=0,i=0,r=0):(a=Math.floor(e/1e3),i=Math.floor(a/60),r=Math.floor(i/60),a%=60,i%=60),n=10>r?"0"+r:r,t=10>i?"0"+i:i,o=10>a?"0"+a:a,e>36e5&&(l+=n+s),l+=t+s+o}Config.soundCloudClientId="4749a2efd4a2c9e32da324378a51ae03";var findElementPosition=function(e){var n=0,t=0;if(e.offsetLeft&&(n+=parseInt(e.offsetLeft,10)),e.offsetTop&&(t+=parseInt(e.offsetTop,10)),e.scrollTop&&e.scrollTop>0&&(t-=parseInt(e.scrollTop,10)),e.offsetParent){var o=findElementPosition(e.offsetParent);n+=o[0],t+=o[1]}else if(e.ownerDocument){var a=e.ownerDocument.defaultView;if(!a&&e.ownerDocument.parentWindow&&(a=e.ownerDocument.parentWindow),a&&a.frameElement){var o=findElementPosition(a.frameElement);n+=o[0],t+=o[1]}}return[n,t]},isHiRes=function(){if(window.matchMedia){var e=window.matchMedia("only screen and (-moz-min-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3.0/2), only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen  and (min-device-pixel-ratio: 1.5), only screen and (min-resolution: 1.5dppx)");if(e&&e.matches)return!0}return!1};